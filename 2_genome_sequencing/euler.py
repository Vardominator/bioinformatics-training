import random

def construct_graph(graph_str):
    graph = {}
    for s in graph_str:
        edges = s.split('->')
        node = edges[0].strip()
        neighbors = edges[1].strip().split(',')
        graph[node] = neighbors
    return graph

def find_euler_cycle(graph):
    v0 = random.choice(graph.keys())
    visited_edges = set()
    cycle = []
    def find_cycle(node):
        for neighbor in graph[node]:
            edge = "{} -> {}".format(node, neighbor)
            if edge not in visited_edges:
                visited_edges.add(edge)
                find_cycle(neighbor)
        cycle.append(node)
                
    find_cycle(v0)
    return cycle

def find_euler_path(graph):
    incoming_edges = {}
    for node in graph:
        incoming_edges[node] = 0
    for node in graph:
        for neighbor in graph[node]:
            if neighbor not in incoming_edges:
                incoming_edges[neighbor] = 1
            else:
                incoming_edges[neighbor] += 1
    
    v0 = list(graph.keys())[0]
    # for node in graph:
    #     print("Node:{} ; Outgoing:{} ; Incoming:{}".format(node, len(graph[node]), incoming_edges[node]))
    #     if len(graph[node]) > incoming_edges[node]:
    #         v0 = node
    #         break

    visited_edges = set()
    path = []
    def find_path(node):
        for neighbor in graph[node]:
            edge = "{} -> {}".format(node, neighbor)
            if edge not in visited_edges:
                visited_edges.add(edge)
                if neighbor in graph:
                    find_path(neighbor)
                else:
                    path.append(neighbor)
        path.append(node)
                
    find_path(v0)
    return path

with open('data/d6.txt', 'r') as f:
    graph_str = f.read().splitlines()

graph = construct_graph(graph_str)
path = find_euler_path(graph)
print(path)
circular_str = path[0]
for p in path[1:]:
    circular_str += p[-1]

print(circular_str)

with open('data/d6result.txt', 'w') as f:
    f.write('->'.join([c for c in path[::-1]]))
# 0000000100000011000100010010000100110010001100110100000101000011010100010101001001010011011000010110001101110000111000101110010011100111010001110100101011001111000111101001011010011111000111111001111001101011011011111001010111001111111011011101110111100110

# 00000001010000011101111100111000110100101100000010110000010101000101111000010111011110010101011101110011000011101001111100110110101001011101001110100110100110001001110000110101101110001001000001110000010101010001100001111111111100101101001110001100000100011111010
# 0000000001100101100010010101000010101010001100011111010000010101111101110110111010001001010110100010000101100111010011010011101101110100001111001010100110101100100110110110100101010101110110111010110101101001001001010101010110010110101100010011100101010010110101011000110100000110101011100101010101010111011001100000100011111101001101000110000111110011100100110101100111100010000001011010001100110010100110101100001111000001001101000110011110111010010110111000100100010000010111110100000111011010101111010101101110010110
# 001001010010001011010110010001100010011100000000010000001111010000101000011111011110001100101111001111011100011100010001111110001010011000011000001100110011111001101111111110010101010010101101000110111010111110000101110011000110101110100010101000111010010110001011111101011011100101101101010110000100100110010010000010110011010100111011101111101001101101100101000100001000100101110110001111001001111111011001110010000110110000001010111000011100111010100000111011011110101010111101101001111000001001101000000011010010010
# 001001010010001011010110010001100010011100000000010000001111010000101000011111011110001100101111001111011100011100010001111110001010011000011000001100110011111001101111111110010101010010101101000110111010111110000101110011000110101110100010101000111010010110001011111101011011100101101101010110000100100110010010000010110011010100111011101111101001101101100101000100001000100101110110001111001001111111011001110010000110110000001010111000011100111010100000111011011110101010111101101001111000001001101000000011010010010
# 0000000000000001111111110111101110111110110110111111010110111010111011010111101010110101010111111100101111100110111100111011100101011100111101100101101100110101100111001100111110100101110100110110100111010100101010100110010100111100100101100100110100100100111111000101111000110111000100111000111011000101011000110011000111101000101101000110101000100101000111001000101001000110001000111110000101110000110110000100110000111010000101010000110010000100010000111100000101100000110100000100100000111000000101000000110000000100
# 0010010100100010110101100100011000100111000000000100000011110100001010000111110111100011001011110011110111000111000100011111100010100110000110000011001100111110011011111111100101010100101011010001101110101111100001011100110001101011101000101010001110100101100010111111010110111001011011010101100001001001100100100000101100110101001110111011111010011011011001010001000010001001011101100011110010011111110110011100100001101100000010101110000111001110101000001110110111101010101111011010011110000010011010000000110100100101
